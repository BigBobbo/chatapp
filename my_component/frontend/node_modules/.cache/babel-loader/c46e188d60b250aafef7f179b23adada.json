{"ast":null,"code":"// Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT license.\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nimport { ArgumentNullError, createNoDashGuid } from \"../common/Exports\";\nimport { WebsocketMessageAdapter } from \"./WebsocketMessageAdapter\";\nexport class WebsocketConnection {\n  constructor(uri, queryParameters, headers, messageFormatter, proxyInfo) {\n    let enableCompression = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;\n    let connectionId = arguments.length > 6 ? arguments[6] : undefined;\n    this.privIsDisposed = false;\n    if (!uri) {\n      throw new ArgumentNullError(\"uri\");\n    }\n    if (!messageFormatter) {\n      throw new ArgumentNullError(\"messageFormatter\");\n    }\n    this.privMessageFormatter = messageFormatter;\n    let queryParams = \"\";\n    let i = 0;\n    if (queryParameters) {\n      for (const paramName in queryParameters) {\n        if (paramName) {\n          queryParams += i === 0 && uri.indexOf(\"?\") === -1 ? \"?\" : \"&\";\n          const val = encodeURIComponent(queryParameters[paramName]);\n          queryParams += `${paramName}=${val}`;\n          i++;\n        }\n      }\n    }\n    if (headers) {\n      for (const headerName in headers) {\n        if (headerName) {\n          queryParams += i === 0 && uri.indexOf(\"?\") === -1 ? \"?\" : \"&\";\n          const val = encodeURIComponent(headers[headerName]);\n          queryParams += `${headerName}=${val}`;\n          i++;\n        }\n      }\n    }\n    this.privUri = uri + queryParams;\n    this.privId = connectionId ? connectionId : createNoDashGuid();\n    this.privConnectionMessageAdapter = new WebsocketMessageAdapter(this.privUri, this.id, this.privMessageFormatter, proxyInfo, headers, enableCompression);\n  }\n  dispose() {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.privIsDisposed = true;\n      if (this.privConnectionMessageAdapter) {\n        yield this.privConnectionMessageAdapter.close();\n      }\n    });\n  }\n  isDisposed() {\n    return this.privIsDisposed;\n  }\n  get id() {\n    return this.privId;\n  }\n  state() {\n    return this.privConnectionMessageAdapter.state;\n  }\n  open() {\n    return this.privConnectionMessageAdapter.open();\n  }\n  send(message) {\n    return this.privConnectionMessageAdapter.send(message);\n  }\n  read() {\n    return this.privConnectionMessageAdapter.read();\n  }\n  get events() {\n    return this.privConnectionMessageAdapter.events;\n  }\n}","map":{"version":3,"mappings":"AAAA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,SACIA,iBAAiB,EAKjBC,gBAAgB,QAKb,mBAAmB;AAE1B,SAASC,uBAAuB,QAAQ,2BAA2B;AAEnE,OAAM,MAAOC,mBAAmB;EAQ5BC,YACIC,GAAW,EACXC,eAA0C,EAC1CC,OAAkC,EAClCC,gBAA4C,EAC5CC,SAAoB,EAEC;IAAA,IADrBC,wFAA6B,KAAK;IAAA,IAClCC,YAAqB;IATjB,mBAAc,GAAY,KAAK;IAWnC,IAAI,CAACN,GAAG,EAAE;MACN,MAAM,IAAIL,iBAAiB,CAAC,KAAK,CAAC;;IAGtC,IAAI,CAACQ,gBAAgB,EAAE;MACnB,MAAM,IAAIR,iBAAiB,CAAC,kBAAkB,CAAC;;IAGnD,IAAI,CAACY,oBAAoB,GAAGJ,gBAAgB;IAE5C,IAAIK,WAAW,GAAG,EAAE;IACpB,IAAIC,CAAC,GAAG,CAAC;IAET,IAAIR,eAAe,EAAE;MACjB,KAAK,MAAMS,SAAS,IAAIT,eAAe,EAAE;QACrC,IAAIS,SAAS,EAAE;UACXF,WAAW,IAAMC,CAAC,KAAK,CAAC,IAAMT,GAAG,CAACW,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAE,GAAI,GAAG,GAAG,GAAG;UACnE,MAAMC,GAAG,GAAGC,kBAAkB,CAACZ,eAAe,CAACS,SAAS,CAAC,CAAC;UAC1DF,WAAW,IAAI,GAAGE,SAAS,IAAIE,GAAG,EAAE;UACpCH,CAAC,EAAE;;;;IAKf,IAAIP,OAAO,EAAE;MACT,KAAK,MAAMY,UAAU,IAAIZ,OAAO,EAAE;QAC9B,IAAIY,UAAU,EAAE;UACZN,WAAW,IAAMC,CAAC,KAAK,CAAC,IAAMT,GAAG,CAACW,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAE,GAAI,GAAG,GAAG,GAAG;UACnE,MAAMC,GAAG,GAAGC,kBAAkB,CAACX,OAAO,CAACY,UAAU,CAAC,CAAC;UACnDN,WAAW,IAAI,GAAGM,UAAU,IAAIF,GAAG,EAAE;UACrCH,CAAC,EAAE;;;;IAKf,IAAI,CAACM,OAAO,GAAGf,GAAG,GAAGQ,WAAW;IAChC,IAAI,CAACQ,MAAM,GAAGV,YAAY,GAAGA,YAAY,GAAGV,gBAAgB,EAAE;IAE9D,IAAI,CAACqB,4BAA4B,GAAG,IAAIpB,uBAAuB,CAC3D,IAAI,CAACkB,OAAO,EACZ,IAAI,CAACG,EAAE,EACP,IAAI,CAACX,oBAAoB,EACzBH,SAAS,EACTF,OAAO,EACPG,iBAAiB,CAAC;EAC1B;EAEac,OAAO;;MAChB,IAAI,CAACC,cAAc,GAAG,IAAI;MAE1B,IAAI,IAAI,CAACH,4BAA4B,EAAE;QACnC,MAAM,IAAI,CAACA,4BAA4B,CAACI,KAAK,EAAE;;IAEvD,CAAC;;EAEMC,UAAU;IACb,OAAO,IAAI,CAACF,cAAc;EAC9B;EAEA,IAAWF,EAAE;IACT,OAAO,IAAI,CAACF,MAAM;EACtB;EAEOO,KAAK;IACR,OAAO,IAAI,CAACN,4BAA4B,CAACM,KAAK;EAClD;EAEOC,IAAI;IACP,OAAO,IAAI,CAACP,4BAA4B,CAACO,IAAI,EAAE;EACnD;EAEOC,IAAI,CAACC,OAA0B;IAClC,OAAO,IAAI,CAACT,4BAA4B,CAACQ,IAAI,CAACC,OAAO,CAAC;EAC1D;EAEOC,IAAI;IACP,OAAO,IAAI,CAACV,4BAA4B,CAACU,IAAI,EAAE;EACnD;EAEA,IAAWC,MAAM;IACb,OAAO,IAAI,CAACX,4BAA4B,CAACW,MAAM;EACnD","names":["ArgumentNullError","createNoDashGuid","WebsocketMessageAdapter","WebsocketConnection","constructor","uri","queryParameters","headers","messageFormatter","proxyInfo","enableCompression","connectionId","privMessageFormatter","queryParams","i","paramName","indexOf","val","encodeURIComponent","headerName","privUri","privId","privConnectionMessageAdapter","id","dispose","privIsDisposed","close","isDisposed","state","open","send","message","read","events"],"sources":["src/common.browser/WebsocketConnection.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    ArgumentNullError,\r\n    ConnectionEvent,\r\n    ConnectionMessage,\r\n    ConnectionOpenResponse,\r\n    ConnectionState,\r\n    createNoDashGuid,\r\n    EventSource,\r\n    IConnection,\r\n    IStringDictionary,\r\n    IWebsocketMessageFormatter,\r\n} from \"../common/Exports\";\r\nimport { ProxyInfo } from \"./ProxyInfo\";\r\nimport { WebsocketMessageAdapter } from \"./WebsocketMessageAdapter\";\r\n\r\nexport class WebsocketConnection implements IConnection {\r\n\r\n    private privUri: string;\r\n    private privMessageFormatter: IWebsocketMessageFormatter;\r\n    private privConnectionMessageAdapter: WebsocketMessageAdapter;\r\n    private privId: string;\r\n    private privIsDisposed: boolean = false;\r\n\r\n    public constructor(\r\n        uri: string,\r\n        queryParameters: IStringDictionary<string>,\r\n        headers: IStringDictionary<string>,\r\n        messageFormatter: IWebsocketMessageFormatter,\r\n        proxyInfo: ProxyInfo,\r\n        enableCompression: boolean = false,\r\n        connectionId?: string) {\r\n\r\n        if (!uri) {\r\n            throw new ArgumentNullError(\"uri\");\r\n        }\r\n\r\n        if (!messageFormatter) {\r\n            throw new ArgumentNullError(\"messageFormatter\");\r\n        }\r\n\r\n        this.privMessageFormatter = messageFormatter;\r\n\r\n        let queryParams = \"\";\r\n        let i = 0;\r\n\r\n        if (queryParameters) {\r\n            for (const paramName in queryParameters) {\r\n                if (paramName) {\r\n                    queryParams += ((i === 0) && (uri.indexOf(\"?\") === -1)) ? \"?\" : \"&\";\r\n                    const val = encodeURIComponent(queryParameters[paramName]);\r\n                    queryParams += `${paramName}=${val}`;\r\n                    i++;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (headers) {\r\n            for (const headerName in headers) {\r\n                if (headerName) {\r\n                    queryParams += ((i === 0) && (uri.indexOf(\"?\") === -1)) ? \"?\" : \"&\";\r\n                    const val = encodeURIComponent(headers[headerName]);\r\n                    queryParams += `${headerName}=${val}`;\r\n                    i++;\r\n                }\r\n            }\r\n        }\r\n\r\n        this.privUri = uri + queryParams;\r\n        this.privId = connectionId ? connectionId : createNoDashGuid();\r\n\r\n        this.privConnectionMessageAdapter = new WebsocketMessageAdapter(\r\n            this.privUri,\r\n            this.id,\r\n            this.privMessageFormatter,\r\n            proxyInfo,\r\n            headers,\r\n            enableCompression);\r\n    }\r\n\r\n    public async dispose(): Promise<void> {\r\n        this.privIsDisposed = true;\r\n\r\n        if (this.privConnectionMessageAdapter) {\r\n            await this.privConnectionMessageAdapter.close();\r\n        }\r\n    }\r\n\r\n    public isDisposed(): boolean {\r\n        return this.privIsDisposed;\r\n    }\r\n\r\n    public get id(): string {\r\n        return this.privId;\r\n    }\r\n\r\n    public state(): ConnectionState {\r\n        return this.privConnectionMessageAdapter.state;\r\n    }\r\n\r\n    public open(): Promise<ConnectionOpenResponse> {\r\n        return this.privConnectionMessageAdapter.open();\r\n    }\r\n\r\n    public send(message: ConnectionMessage): Promise<void> {\r\n        return this.privConnectionMessageAdapter.send(message);\r\n    }\r\n\r\n    public read(): Promise<ConnectionMessage> {\r\n        return this.privConnectionMessageAdapter.read();\r\n    }\r\n\r\n    public get events(): EventSource<ConnectionEvent> {\r\n        return this.privConnectionMessageAdapter.events;\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}